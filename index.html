<!DOCTYPE html>
<html lang="">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    .green { color: green; }
    .yellow { color: goldenrod; }
    .red { color: red; }
    footer {
      background-color: #dddddd;
      color: #000000;
      text-align: center;
      padding: 2px;
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
    }
    .center {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    html * {
      font-family: Calibri, Helvetica, Arial, sans-serif;
    }

  </style>
  <head>
    <title>chemicle</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon-light.png" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/x-icon" href="assets/favicon-dark.png" media="(prefers-color-scheme: dark)">
  </head>
  <script type="text/JavaScript">
    // Organic Chemical Type (type, max)
    class oct {
      constructor(type, max, date = null) {
        this._enabled = true;
        this._type = type;
        this._max = max;
        this._date = date;
        this._checkbox = null;
      }

      get enabled() {
        return this._enabled;
      }

      set enabled(value) {
        this._enabled = value;

      }

      disable() {
        this._enabled = false;
        this._checkbox.checked = false;
        setStorage(this._type, false, false);
      }

      get type() {
        return this._type;
      }

      get max() {
        return this._max;
      }

      get date() {
        return this._date;
      }

      get checkbox() {
        return this._checkbox;
      }

      set checkbox(value) {
        this._checkbox = value;
      }

      checkTimeBasedEnable () {
        if(this._date === null) {
          return false;
        }
        let now = Date.now();
        let compareTo = new Date(this._date);
        compareTo.setUTCHours(5);
        return compareTo.getTime() <= now;
      }


    }

    const typeList = [new oct("alkane", 71, "2025-01-01"), new oct("alkene", 33, "2025-02-04"),
      new oct("alkyne", 24, "2025-02-04"), new oct("alcohol", 12, "2025-02-10"),
      new oct("ketone", 13, "2025-02-10"), new oct("carboxylicAcid", 29, "2025-02-12"),
      new oct("aldehyde", 28, "2025-02-10"), new oct("ether", 12, "2025-02-13"),
      new oct("ester", 18, "2025-02-12"), new oct("amine", 32, "2025-02-13"),
      new oct("amide", 12, "2025-02-13"), new oct("nitrile", 4),
      new oct("misc", 7)];

    let idNum;

    let moleculeType;
    let moleculeId;

    let trueMoleculeName;
    let trueMoleculeFormula;

    let doneLoading = false;

    let curSplit = "";
    let curGuessNum = 1;
    let correctGuess = false;

    let moleculeNum = 1;

    let settingsButton;
    let settingsCloseButton;
    let settingsDiv;
    let settingsFieldset;
    let settingsLegendDiv;
    let settingsBackgroundDiv;

    let generateNewMoleculeButton;

    let tutorialButton;
    let tutorialCloseButton;
    let tutorialDiv;
    let tutorialFieldset;
    let tutorialBackgroundDiv;

    let albrittonModeCheck;
    let gradualHintsCheck;
    let gradualHints;
    let changedSettings = false;
    let numBoxesChecked = 0;
    let formulaButton;
    let formulaDiv;
    let lineButton;
    let lineImage;
    let lewisButton;
    let lewisImage;
    let solutionButton;
    let solutionDiv;

    document.addEventListener("DOMContentLoaded", async function () {
      checkStorageSettings();
      generateId(moleculeNum);
      while (!doneLoading) {
        await new Promise(r => setTimeout(r, 10))
      }
      reloadAssets();
      updateFromStorage();
    });

    function checkStorageSettings() {
      if(getStorage("moleculeNum") === "") {
        moleculeNum = 1;
      } else {
        moleculeNum = parseInt(getStorage("moleculeNum"))
      }

      for (let i = 0; i < typeList.length; i++) {
        let obj = typeList[i];
        if(getStorage(obj.type) === "") {
          for (let j = 0; j < typeList.length; j++) {
            let obj2 = typeList[j];
            if(obj2.checkTimeBasedEnable()) {
              obj2.enabled = true;
              setStorage(obj2.type, true, false);
            }
            else {
              obj2.enabled = false;
              setStorage(obj2.type, false, false);
            }
          }
          setStorage("albrittonMode", true, false);
          break;
        }
        else obj.enabled = getStorage(obj.type) === true;
      }
      if(getStorage("gradualHints") === "") {
        gradualHints = false;
        setStorage("gradualHints", false, false)
      } else {
        gradualHints = !!getStorage("gradualHints");
      }



    }

    function generateId(moleculeNum = 1) {
      document.getElementById("guessInput").value = "";
      let totalMax = 0;

      for (let i = 0; i < typeList.length; i++) {
        if (typeList[i].enabled) {
          totalMax += typeList[i].max;
        }
      }

      // Random selection for ids based on date
      function getDailyIdNum(maxValue, moleculeN = 1) {
        function dailyRandom() {
          // Partly generated by ChatGPT

          // Create a Date object for December 1st, 2024, 5:00 AM GMT
          const dec1st5AM = new Date(Date.UTC(2024, 11, 1, 5, 0, 0, 0)); // 11 = December (months are 0-indexed)

          // Get the current date and time in GMT
          const now = new Date();

          // Calculate the difference in milliseconds
          const diffInMs = now - dec1st5AM;

          // Convert milliseconds to days (1 day = 24 * 60 * 60 * 1000 ms)
          let diffInDays = Math.floor(diffInMs / (24 * 60 * 60 * 1000));

          return Math.abs(random(diffInDays));
        }
        // Deterministic random algorithm
        function random(seed) {
          let t = (seed ^ 0xEFC5DAF8) + (seed << 3);
          t = (t ^ (t >>> 16)) * 0x42EDBF1C;
          t = (t ^ (t >>> 13)) * 0xD9AAB462;
          t = t ^ (t >>> 16);
          return t;
        }
        let d = dailyRandom();
        let add = 0;
        if(moleculeNum > 1) {
          add = (random(moleculeN) * d) % 100000
        }
        //console.log("Add:" + add)
        return (d + add) % maxValue + 1;
      }

      idNum = getDailyIdNum(totalMax, moleculeNum);
      function checkWithin (max, type) {
        if(idNum <= max) {
          moleculeType = type;
          return true;
        }
        else {
          idNum -= max;
          return false;
        }
      }

      for (let i = 0; i < typeList.length; i++) {
        if (typeList[i].enabled) {
          if (checkWithin(typeList[i].max, typeList[i].type)) {
            break;
          }
        }
      }
      moleculeId = moleculeType + "-" + (idNum).toString().padStart(3, "0");
      console.log("Molecule #" + moleculeNum)
      console.log(moleculeId);

      fetch("assets/" + moleculeId + "/name.txt")
              .then((res) => res.text())
              .then((text) => {
                const splitString = text.split(", ");
                //console.log(splitString);
                trueMoleculeName = splitString[0].replaceAll("\"", "");
                trueMoleculeFormula = splitString[1].replaceAll("\"", "");
                trueMoleculeFormula = trueMoleculeFormula.replaceAll(/(\d+)/g, '<sub>$1</sub>');
                doneLoading = true;
              })
              .catch((e) => console.error(e));
    }

    function reloadAssets() {
      settingsButton = document.getElementById('settingsButton');
      settingsCloseButton = document.getElementById('settingsCloseButton');
      settingsDiv = document.getElementById('settings');
      settingsFieldset = document.getElementById('settingsFieldset');
      settingsBackgroundDiv = document.getElementById('settingsBackground');

      tutorialButton = document.getElementById('tutorialButton');
      tutorialCloseButton = document.getElementById('tutorialCloseButton');
      tutorialDiv = document.getElementById('tutorial');
      tutorialFieldset = document.getElementById('tutorialFieldset');
      tutorialBackgroundDiv = document.getElementById('tutorialBackground');

      generateNewMoleculeButton = document.getElementById('generateNewButton');

      albrittonModeCheck = document.getElementById('albrittonModeCheck');
      gradualHintsCheck = document.getElementById('gradualHintsCheck');

      formulaButton = document.getElementById('formulaButton');
      formulaDiv = document.getElementById('formula');

      lineButton = document.getElementById('lineButton');
      lineImage = document.getElementById('line');
      lineImage.src = "assets/" + moleculeId + "/line.png";

      lewisButton = document.getElementById('lewisButton');
      lewisImage = document.getElementById('lewis');
      lewisImage.src = "assets/" + moleculeId + "/lewis.png";

      solutionButton = document.getElementById('solutionButton');
      solutionDiv = document.getElementById('solution');

      function toggleVisibility(button, element, name, isImage = true) {
        if(isImage) {
          if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block'; // Show the image
            if(button != null) {
              button.innerHTML = "Hide " + name;
            }
          } else {
            element.style.display = 'none'; // Hide the image
            if(button != null) {
              button.innerHTML = "Show " + name;
            }
          }
        }
        else {
          if (element.hidden) {
            element.hidden = false; // Show the image
            if(button != null) {
              button.innerHTML = "Hide " + name;
            }
          } else {
            element.hidden = true; // Hide the image
            if(button != null) {
              button.innerHTML = "Show " + name;
            }
          }
        }
      }

      settingsButton.addEventListener('click', () => {
        toggleVisibility(null, settingsDiv, "Settings", false)
        toggleVisibility(null, settingsBackgroundDiv, "SettingsBackground", false)
      });

      settingsCloseButton.addEventListener('click', () => {
        toggleVisibility(null, settingsDiv, "Settings", false)
        toggleVisibility(null, settingsBackgroundDiv, "SettingsBackground", false)
        if(changedSettings) {
          location.reload();
        }
      });

      settingsBackgroundDiv.addEventListener('click', () => {
        toggleVisibility(null, settingsDiv, "Settings", false)
        toggleVisibility(null, settingsBackgroundDiv, "SettingsBackground", false)
        if(changedSettings) {
          location.reload();
        }
      });

      tutorialButton.addEventListener('click', () => {
        toggleVisibility(null, tutorialDiv, "Tutorial", false)
        toggleVisibility(null, tutorialBackgroundDiv, "TutorialBackground", false)
        setStorage("seenTutorial", true, false);
      });

      tutorialCloseButton.addEventListener('click', () => {
        toggleVisibility(null, tutorialDiv, "Tutorial", false)
        toggleVisibility(null, tutorialBackgroundDiv, "TutorialBackground", false)
        setStorage("seenTutorial", true, false);
      });

      tutorialBackgroundDiv.addEventListener('click', () => {
        toggleVisibility(null, tutorialDiv, "Tutorial", false)
        toggleVisibility(null, tutorialBackgroundDiv, "TutorialBackground", false)
        setStorage("seenTutorial", true, false);
      });

      generateNewMoleculeButton.addEventListener('click', () => {
        moleculeNum++;
        setStorage("moleculeNum", moleculeNum);
        changedSettings = true;
        setStorage("changedSettings", true, false);
        location.reload();
      });

      formulaButton.addEventListener('click', () => {
        toggleVisibility(formulaButton, formulaDiv, "Chemical Formula", false)
        setStorage("formulaDivHidden", formulaDiv.hidden, false);
      });

      lineButton.addEventListener('click', () => {
        toggleVisibility(lineButton, lineImage, "Line Structure")
        let shown = lineImage.style.display === "block";
        setStorage("lineImageHidden", !shown, false);
      });

      lewisButton.addEventListener('click', () => {
        toggleVisibility(lewisButton, lewisImage, "Lewis Structure")
        let shown = lewisImage.style.display === "block";
        setStorage("lewisImageHidden", !shown, false);
      });

      solutionButton.addEventListener('click', () => {
        toggleVisibility(solutionButton, solutionDiv, "Solution", false)
      });

      albrittonModeCheck.addEventListener('change', () => {
        settingsFieldset.disabled = albrittonModeCheck.checked;
        if(albrittonModeCheck.checked) {
          numBoxesChecked = 0;
          for (let i = 0; i < typeList.length; i++) {
            let obj = typeList[i];
            if(obj.checkTimeBasedEnable()) {
              obj.enabled = true;
              obj.checkbox.checked = true;
              setStorage(obj.type, true, false)
              numBoxesChecked++;
            } else {
              obj.enabled = false;
              obj.checkbox.checked = false;
              setStorage(obj.type, false, false)
            }
          }
          setStorage("albrittonMode", true, false);
        }
        else {
          setStorage("albrittonMode", false, false);
        }
        changedSettings = true;
        setStorage("changedSettings", true, false);
      });

      if(getStorage("albrittonMode")) {
        albrittonModeCheck.checked = true;
        settingsFieldset.disabled = true;
      }

      gradualHintsCheck.addEventListener('change', () => {
        gradualHints = gradualHintsCheck.checked;
        setStorage("gradualHints", gradualHints, false);
        changedSettings = true;
        setStorage("changedSettings", true, false);
      });

      gradualHintsCheck.checked = gradualHints;

      for (let i = 0; i < typeList.length; i++) {
        let obj = typeList[i];

        settingsLegendDiv = document.getElementById('settingsLegend');

        const newDiv = document.createElement("div");
        const newInput = document.createElement("input");
        newInput.type = "checkbox";
        newInput.id = obj.type + "Check";
        newInput.name = obj.type + "Check";
        newInput.value = obj.type;
        const newLabel = document.createElement("label");
        newLabel.htmlFor = obj.type + "Check";
        newLabel.innerHTML = obj.type.replace(/([A-Z])/g, ' $1') // Add space before each capital letter
                .replace(/^./, match => match.toUpperCase()) // Capitalize the first character
                .trim(); // Remove leading or trailing spaces, if any;
        newDiv.insertBefore(newLabel, null);
        newDiv.insertBefore(newInput, newLabel);
        settingsLegendDiv.parentNode.insertBefore(newDiv, null);
        obj.checkbox = newInput;
        newInput.addEventListener('change', () => {
          if(newInput.checked) {
            obj.enabled = true;
            setStorage(obj.type, true, false);
            numBoxesChecked++;
            changedSettings = true;
            setStorage("changedSettings", true, false);
          }
          else {
            if(numBoxesChecked > 1) {
              obj.enabled = false;
              setStorage(obj.type, false, false);
              numBoxesChecked--;
              changedSettings = true;
              setStorage("changedSettings", true, false);
            }
            else {
              newInput.checked = true;
            }
          }
        });
        if(obj.enabled) {
          newInput.checked = true;
          numBoxesChecked++;
        }
      }
    }

    function updateFromStorage() {
      if(getStorage("changedSettings") === true) {
        setStorage("changedSettings", false, false);
        let i = 1;
        while(getStorage("guess" + i) !== "") {
          removeStorage("guess" + i);
          i++;
        }
        removeStorage("curGuessNum")
      }
      else if (getStorage("curGuessNum") !== "" && getStorage("curGuessNum") > 1) {
        let guessNum = getStorage("curGuessNum");
        for (let i = 1; i < guessNum; i++) {
          curSplit = getStorage("guess" + i).split(',').map(item => item === "" ? "," : item).filter((item, index, array) => item !== ',' || array[index - 1] !== ',');

          //console.log("Updating guess" + i + " to " + curSplit)
          showGuess(true);
        }
      }
      if(getStorage("gradualHints") === false) {
        showHint(1);
        showHint(2);
        showHint(3);
      }
      if(getStorage("seenTutorial") === "") {
        tutorialButton.click();
      }

    }

    function handleSubmit() {
      const inputText = document.getElementById("guessInput").value;
      const output = splitOrganicString(inputText);
      if (!output) {
        document.getElementById("validWarning").hidden = false;
        return false;
      } else {
        document.getElementById("validWarning").hidden = true;
        curSplit = output;
        showGuess();
        return false;
      }
    }

    function splitOrganicString(input) {
      // Validity Checker and regex generated by ChatGPT, with prompts, fixes and major modifications made by self
      // Define the valid organic chemical parts
      const validParts = [
        "yl", "ane", "ene", "yne",                                                // Suffixes for types of hydrocarbons
        "di", "tri", "tetra",                                                     // Multipliers for side chains
        "iso", "cyclo", "poly", "benz", "form", "acet",                           // Miscellaneous prefixes
        "fluoro", "chloro", "bromo", "iodo",                                      // Halides
        "oxy", "hydroxy", "amine", "oxo",                                         // Functional groups
        "acid", "oate", "anoate", "ether",  "nitrile",                            // More functional groups
        "1", "2", "3", "4", "5", "6", "7", "8", "9", "0", ",", "-", "(", ")",     // Positions (1-9)
        "meth", "eth", "prop", "but", "pent", "hex", "hept", "oct", "non", "dec", // Standard prefixes for chain lengths
        "an", "ol", "one", "al", "oic", "ic", "ate", "a", "en", "yn", "o",        // Misc suffixes for compact spelling
        "tert", "sec",                                                            // Butyl prefixes
      ];

      // Remove whitespace from the input
      input = input.replace(/\s+/g, '').toLowerCase();

      // Result array to store parts
      const result = [];

      // Define a helper function to find the longest matching part from the input
      function matchPart(input) {
        for (let part of validParts) {
          if (input.startsWith(part)) {
            return part;
          }
        }
        return null;  // No valid part found
      }

      // Loop through the input to match parts
      while (input.length > 0) {
        const matchedPart = matchPart(input);

        if (!matchedPart) {
          // No valid part matched; return false
          return false;
        }

        // Add the matched part to the result array
        result.push(matchedPart);

        // Remove the matched part from the beginning of the input
        input = input.slice(matchedPart.length);
      }

      // Return the list of matched parts
      return result;
    }

    function displayColoredText(input, stored, num) {
      // Code generated by ChatGPT, prompt and modifications made by self
      let allCorrect = true;
      let outputDiv;
      try {
        outputDiv = document.getElementById("guess" + num);
      }
      catch(e) {
        console.log("The output div guess + " + num + "does not exist")
        return;
      }
      outputDiv.innerHTML = ''; // Clear any existing content
      const matchedStored = Array(stored.length).fill(false); // Tracks matches in Stored array

      // Step 1: Exact matches (green)
      const results = input.map((item, index) => {
        if (item === stored[index]) {
          matchedStored[index] = true; // Mark exact match in Stored
          return {text: item, colorClass: 'green'};
        }
        return {text: item, colorClass: null}; // Placeholder for later steps
      });

      // Step 2: Non-index matches (yellow)
      results.forEach(result => {
        if (result.colorClass === null) { // Only process items not already green
          const storedIndex = stored.findIndex((item, i) => item === result.text && !matchedStored[i]);
          if (storedIndex !== -1) { // If there's an unmatched stored item
            matchedStored[storedIndex] = true; // Mark this stored item as matched
            result.colorClass = 'yellow';
            allCorrect = false;
          } else {
            result.colorClass = 'red'; // No match found in Stored
            allCorrect = false;
          }
        }
      });

      // Step 3: Display the results
      results.forEach(result => {
        const span = document.createElement('span');
        span.className = result.colorClass;
        span.textContent = result.text + ' ';
        outputDiv.appendChild(span);
      });

      // Step 4: Determine length message
      const lengthMessage = document.createElement('div');
      if (input.length < stored.length) {
        lengthMessage.textContent = 'too short';
      } else if (input.length > stored.length) {
        lengthMessage.textContent = 'too long';
      } else {
        lengthMessage.textContent = 'correct length';
        if(allCorrect) {
          correctGuess = true;
        }
      }
      lengthMessage.setAttribute("style", "padding-bottom: 0.2%");
      outputDiv.appendChild(lengthMessage);
    }

    function showGuess(fromStorage = false){
      displayColoredText(curSplit, splitOrganicString(trueMoleculeName), curGuessNum)
      if(!fromStorage) {
        setStorage("guess" + curGuessNum, curSplit)
      }
      // Clear input box
      document.getElementById("guessInput").value = "";

      if(correctGuess) {
        document.getElementById("guessInput").hidden = true;
        document.getElementById("submitButton").hidden = true;

        const newDiv = document.createElement("div");
        newDiv.id = "congratsMessage";
        newDiv.style.setProperty("text-align", "center");
        newDiv.style.paddingTop = "0.1%";
        const lastDiv = document.getElementById("guess" + curGuessNum);
        lastDiv.parentNode.insertBefore(newDiv, lastDiv.nextSibling);

        const span = document.createElement('span');
        span.className = 'green';
        span.innerHTML = "<b>Correct!</b>";
        newDiv.appendChild(span);
        showHint(1);
        showHint(2);
        showHint(3);
        showHint(4);
      }
      // Increment guess number
      if(curGuessNum <= 8) {
        curGuessNum++;
        // Add new div
        const newDiv = document.createElement("div");
        newDiv.id = "guess" + curGuessNum;
        newDiv.style.setProperty("text-align", "center");
        const lastDiv = document.getElementById("guess" + (curGuessNum - 1));
        lastDiv.parentNode.insertBefore(newDiv, lastDiv.nextSibling);
      }

      if(!fromStorage) {
        setStorage("curGuessNum", curGuessNum)
      }
      // Show corresponding hint
      if (curGuessNum === 2) {
        showHint(1);
      } else if (curGuessNum === 4) {
        showHint(2);
      } else if (curGuessNum === 6) {
        showHint(3);
      } else if (curGuessNum >= 8) {
        showHint(4);
      }
    }

    function showHint(hintNum) {
      switch (hintNum) {
        case 1:
          formulaButton.style.display = 'block';
          formulaDiv.innerHTML = "Formula = " + trueMoleculeFormula;
          if(((getStorage("formulaDivHidden") === true && formulaDiv.hidden === false)
                  || (getStorage("formulaDivHidden") === false && formulaDiv.hidden === true))) {
            formulaButton.click();
          }
          break;
        case 2:
          lineButton.style.display = 'block';
          if(((getStorage("lineImageHidden") === true && lineImage.style.display === "block")
                  || (getStorage("lineImageHidden") === false && lineImage.style.display !== "block"))) {
            lineButton.click();
          }
          break;
        case 3:
          lewisButton.style.display = 'block';
          if(((getStorage("lewisImageHidden") === true && lewisImage.style.display === "block")
                  || (getStorage("lewisImageHidden") === false && lewisImage.style.display !== "block"))) {
            lewisButton.click();
          }
          break;
        case 4:
          solutionButton.style.display = 'block';
          solutionDiv.innerHTML = "Solution = " + trueMoleculeName;
          break;
        default:
          console.log("No hint for hintNum " + hintNum)
      }
    }

    function setStorage (id, value, expire = true) {
      if(expire) {
        const now = new Date();

        // Create a new Date object for 5 AM today
        let next5AM = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 5, 0, 0, 0));

        // If it's already past 5 AM GMT today, move to the next day
        if (now >= next5AM) {
          next5AM = new Date(next5AM.getTime() + 24 * 60 * 60 * 1000);
        }
        let expires = "expires="+ next5AM.getTime();
        localStorage.setItem(id, value + expires);
      }
      else {
        localStorage.setItem(id, value);
      }
    }

    function removeStorage (id) {
      localStorage.removeItem(id);
    }

    function getStorage (id) {
      let out = localStorage.getItem(id);
      if(!out) {
        return "";
      }

      out = out.split("expires=")
      if(out.length === 1) { // no expiry
        //console.log(id + ": " + out[0] + " (no expiry)");
        if(out[0] === "true") return true;
        else if (out[0] === "false") return false;
        return out[0];
      }
      else {
        let d = new Date(parseInt(out[1]));
        let now = Date.now();
        if(now >= d) {
          localStorage.removeItem(id);
          return "";
        }
        else {
          //console.log(id + ": " + out[0]);
          if(out[0] === "true") return true;
          else if (out[0] === "false") return false;
          return out[0];
        }
      }
    }
  </script>

  <body>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@40,400,0,0&icon_names=help,settings" />
    <div style="text-align:center; padding:1vh" >
      <button id="settingsButton" style="background:transparent;border:0px;display:inline">
        <span class="material-symbols-outlined">settings</span></button>
      <div style="padding: 0.1%; font-size: xx-large;text-align: center;align-self:center;display:inline"><b>chemicle</b></div>
      <button id="tutorialButton" style="background:transparent;border:0px;display:inline">
        <span class="material-symbols-outlined">help</span></button>
    </div>

    <div style="text-align:center; padding-bottom:5vh" >
      <button id="generateNewButton" style="">Generate New Molecule</button>
    </div>
    <div id="settings" style="position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 300px;
  max-width: 80vw;
  max-height: 80vh;
  background: white;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  z-index: 101; /* Higher than overlay */
  padding: 20px;
overflow:scroll" hidden="hidden">
      <div class="settingsContent">
        <h2>Settings</h2>
        <input type="checkbox" id="albrittonModeCheck" name="albrittonModeCheck" value = "albrittonMode" title="Automatically enables each type of molecule over time">
        <label for="albrittonModeCheck" title="Automatically enables each type of molecule over time">Albritton Mode   </label>
        <input type="checkbox" id="gradualHintsCheck" name="gradualHintsCheck" value = "gradualHints" style="position:relative">
        <label for="gradualHintsCheck">Gradual Hints</label>

        <fieldset id="settingsFieldset">
          <legend id="settingsLegend">Type Selection</legend>
        </fieldset>

        <div style="padding: 0.5%"></div>
        <button id="settingsCloseButton">Close</button>
      </div>
    </div>
    <div id="settingsBackground" style="position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 100;" hidden="hidden"></div>

    <div id="tutorial" style="position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 500px;
  max-width: 80vw;
  max-height:80vh;
  background: white;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  z-index: 101; /* Higher than overlay */
  padding: 20px;
  overflow:scroll" hidden="hidden">
      <div class="tutorialContent" >
        <h2>Tutorial</h2>
        <p>This is <b>chemicle</b>, a wordle style game for organic chemistry molecules!</p>
        <h3>How to play</h3>
        <p>The website automatically selects a molecule, and your job is to guess its name.</p>
        <p>
          Enter a guess in the box. It will be split into segments (separated by spaces), and each
          segment is colored according to wordle rules.
          <b class="green">Green</b> if it is in the correct spot,
          <b class="yellow">yellow</b> if it appears in the molecule name but in another spot, and
          <b class="red">red</b> if it doesn't appear at all.
        </p>
        <p>
          Additionally, a message of <b>too short</b>, <b>too long</b>, or <b>correct length</b> will
          tell you if your guess needs more or less <u>segments</u>. It does <b>not</b> refer to the
          actual length of the word, nor the chain length of the molecule.
        </p>
        <img id="example1" src="assets/example1.png" alt="Example Guess" class="center" style="width:20%;">
        <p>
          In the example above, there should be a "<b>di</b>" prefix before the "<b class="yellow">methylpentane</b>",
          so it is colored yellow, since it should all be shifted over. Below, it says <b>too short</b>, meaning
          you need to add some segments.
        </p>
        <h3>Customization</h3>
        <p>
          You can click on the settings button to modify how you want to practice. <b>Albritton Mode</b> is on by default,
          meaning molecule types will enable as they are taught in Mr. Albritton's class. You can also disable it and
          choose which ones you want to practice. If you want to be given information gradually as you do guesses, turn
          on the <b>Gradual Hints</b> option. The hints will be given on the 1st, 3rd, and 5th guesses. The solution will
          always be given on the 7th guess.
        </p>
        <img id="example2" src="assets/example2.png" alt="Settings Picture" class="center" style="width:20%;">
        <p>
          Click on the <b>Generate New Molecule</b> button to create a new molecule. You can keep generating new
          molecules as long as you want. The randomness is always seeded based on the day. That means that the 1st,
          2nd, 3rd, etc., molecules of the day will be the same for everyone.
        </p>

        <button id="tutorialCloseButton">Close</button>
      </div>
    </div>
    <div id="tutorialBackground" style="position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 100;" hidden="hidden"></div>

    <div id="guess1" style="text-align: center;"></div>
    <form onsubmit="return handleSubmit();"  style="text-align: center; padding: 1%" autocomplete="off" autocapitalize="off" spellcheck="false">
      <label for="guessInput"></label>
      <input type="text"
             id="guessInput"
             name="guessInput"
             required minlength="4"
             maxlength="40"
             size="15">
      <input type="submit"
             id="submitButton"
             name="submitButton"
             value="Submit">
    </form>
    <p id="validWarning" hidden="hidden" style="color:red;text-align: center;">The input is invalid. Please check spelling and make sure your guess is a real molecule.</p>

    <button id="formulaButton" style="text-align: center; display: none" class="center" >Show Chemical Formula</button>
    <div style="padding: 0.6%"></div>
    <div id="formula" style="text-align: center" hidden="hidden"></div>
    <div style="padding: 0.6%"></div>

    <button id="lineButton" style="text-align: center; display: none" class="center">Show Line Structure</button>
    <div style="padding: 0.6%"></div>
    <img id="line" src="" alt="Line Structure of Molecule" class="center" style="width:20vh; border: 2px solid; display: none" >
    <div style="padding: 0.6%;"></div>

    <button id="lewisButton" style="text-align: center; display: none" class="center" >Show Lewis Structure</button>
    <div style="padding: 0.6%"></div>
    <img id="lewis" src="" alt="Lewis Structure of Molecule" class="center" style="width:20vh; border: 2px solid; display: none" >
    <div style="padding: 0.6%;"></div>

    <button id="solutionButton" style="text-align: center; display: none" class="center" >Show Solution</button>
    <div style="padding: 0.6%"></div>
    <div id="solution" style="text-align: center" hidden="hidden"></div>

  </body>
</html>

