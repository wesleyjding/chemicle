<!DOCTYPE html>
<html lang="">
  <style>
    .green { color: green; }
    .yellow { color: goldenrod; }
    .red { color: red; }
  </style>
  <head>
    <title>Chemicle</title>
    <h1>Chemicle</h1>
  </head>
  
  <script type="text/JavaScript">
    /*
    class Molecule {
      constructor(name) {
        this.name = name;
        this.splitName = this.generateSplit(name);
        this.formula = this.generateFormula();
      }

      generateSplit() {
        return "";
      }

      generateFormula() {
        return "";
      }

      static checkValid() {

      }
    }

    // Alkanes - Only Cs single bonded to Hs, maybe halogenated
    class FullAlkane extends SimpleAlkane {
      constructor(name) {
        super(name)
      }


    }

    // Simple Alkane - No branches, only Cs single bonded to Hs
    class SimpleAlkane extends Molecule {

    }

    // Alkyl Branch -
    class Alkyl extends Molecule {

    }
    */
    function splitOrganicString(input) {
      // Validity Checker and regex generated by ChatGPT, with prompts, fixes and major modifications made by self
      // Define the valid organic chemical parts
      const validParts = [
        "meth", "eth", "prop", "but", "pent", "hex", "hept", "oct", "non", "dec", // Prefixes for chain lengths
        "yl", "ane", "ene", "yne",                                                // Suffixes for types of hydrocarbons
        "di", "tri", "tetra",                                                     // Multipliers for side chains
        "tert-", "t-", "sec-",                                                    // Butyl prefixes
        "iso", "cyclo", "poly", "benz",                                           // Miscellaneous prefixes
        "fluoro", "chloro", "bromo", "iodo",                                      // Halides
        "oxy", "hydroxy", "amino", "oxo", "anol", "anal", "anone", "anoic",       // Functional groups
        "acid", "oate", "anoate", "ether",  "nitrile",                            // More functional groups
        "1", "2", "3", "4", "5", "6", "7", "8", "9", ",", "-",                    // Positions (1-9)
        "an", "ol", "one", "a",                                                   // "Cool" spelling (e.g. propan-2-ol)
      ];

      // Remove whitespace from the input
      input = input.replace(/\s+/g, '');

      // Result array to store parts
      const result = [];

      // Define a helper function to find the longest matching part from the input
      function matchPart(input) {
        for (let part of validParts) {
          if (input.startsWith(part)) {
            return part;
          }
        }
        return null;  // No valid part found
      }

      // Loop through the input to match parts
      while (input.length > 0) {
        const matchedPart = matchPart(input);

        if (!matchedPart) {
          // No valid part matched; return false
          return false;
        }

        // Add the matched part to the result array
        result.push(matchedPart);

        // Remove the matched part from the beginning of the input
        input = input.slice(matchedPart.length);
      }

      // Return the list of matched parts
      return result;
    }

    let trueMolecule = "3-ethyl-2,4-dimethylpentane";

    let curSplit = "";
    let curGuessNum = 1;

    function handleSubmit() {
      const inputText = document.getElementById("guessInput").value;
      const output = splitOrganicString(inputText);
      if (output === false) {
        document.getElementById("validWarning").hidden = false;

        return false;
      } else {
        document.getElementById("validWarning").hidden = true;
        curSplit = output;
        showGuess();
        return false;
      }
    }

    function displayColoredText(input, stored, num) {
      // Code generated by ChatGPT, prompt and modifications made by self

      const outputDiv = document.getElementById("guess" + num);
      outputDiv.innerHTML = ''; // Clear any existing content
      const matchedStored = Array(stored.length).fill(false); // Tracks matches in Stored array

      // Step 1: Exact matches (green)
      const results = input.map((item, index) => {
        if (item === stored[index]) {
          matchedStored[index] = true; // Mark exact match in Stored
          return {text: item, colorClass: 'green'};
        }
        return {text: item, colorClass: null}; // Placeholder for later steps
      });

      // Step 2: Non-index matches (yellow)
      results.forEach(result => {
        if (result.colorClass === null) { // Only process items not already green
          const storedIndex = stored.findIndex((item, i) => item === result.text && !matchedStored[i]);
          if (storedIndex !== -1) { // If there's an unmatched stored item
            matchedStored[storedIndex] = true; // Mark this stored item as matched
            result.colorClass = 'yellow';
          } else {
            result.colorClass = 'red'; // No match found in Stored
          }
        }
      });

      // Step 3: Display the results
      results.forEach(result => {
        const span = document.createElement('span');
        span.className = result.colorClass;
        span.textContent = result.text + ' ';
        outputDiv.appendChild(span);
      });

      // Step 4: Determine length message
      const lengthMessage = document.createElement('div');
      if (input.length < stored.length) {
        lengthMessage.textContent = 'too short';
      } else if (input.length > stored.length) {
        lengthMessage.textContent = 'too long';
      } else {
        lengthMessage.textContent = 'correct length';
      }
      outputDiv.appendChild(lengthMessage);
    }

    function showGuess(){
      let inputText = document.getElementById("guessInput").value;
      //console.log("Showing " + inputText);
      displayColoredText(curSplit, splitOrganicString(trueMolecule), curGuessNum)

      // Clear input box
      document.getElementById("guessInput").value = "";

      // Increment guess number
      curGuessNum++;

      // Add new div
      const newDiv = document.createElement("div");
      newDiv.id = "guess" + curGuessNum;
      const lastDiv = document.getElementById("guess" + (curGuessNum - 1));
      lastDiv.parentNode.insertBefore(newDiv, lastDiv.nextSibling);
    }

    /*function isValidOrganicChemical(name)  {
      // Validity Checker and regex generated by ChatGPT, with prompts, fixes and modifications made by self
      // List of valid roots for hydrocarbons
      const roots = "(meth|eth|prop|but|pent|hex|hept|oct|non|dec|undec|dodec)";

      // Valid saturation suffixes
      const saturationSuffixes = "(ane|ene|yne|anol|anal|anone|anoic\\sacid|oate|anoate|\\sether)";

      // Functional group suffixes
      const functionalGroupSuffixes = "(yl)";

      // Cyclo or iso prefixes
      const prefix = "(cyclo|iso)?";

      // Branching patterns: di, tri, tetra, penta for multiple branches
      const branchPrefixes = "(di|tri|tetra|penta)?";

      // Alkyl chains (with optional number prefixes for positions)
      const alkylBranch = "(\\d{1,2}(,\\d{1,2})*-)?";

      // Handling branch names (like methyl, ethyl, etc.)
      const branch = `(${alkylBranch}${branchPrefixes}${roots}yl)`;

      // Combining all parts to handle alkyl branches (e.g., "2,3-dimethyl")
      const branchPart = `(${branch}(\\-${branch})*)?`;

      // Main hydrocarbon name (prefix + root + saturation + functional group)
      const mainName = `${prefix}${roots}${saturationSuffixes}(${functionalGroupSuffixes})?`;

      // Complete regex pattern for the whole name (optional branches + main name)
      const fullPattern = new RegExp(`^${branchPart}${mainName}$`, 'i');

      // Test if the input name matches the pattern
      return fullPattern.test(name.trim());
    }*/



  </script>
  
  <body>
    <div id="guess1"></div>
    <form onsubmit="return handleSubmit();">
      <label for="guessInput"></label>
      <input type="text"
             id="guessInput"
             name="guessInput"
             required minlength="4"
             maxlength="64"
             size="10" />
      <input type="submit"
             name="submitButton"
             value="Submit" />
    </form>
    <p id="validWarning" hidden="hidden" style="color:red;">The input is invalid. Please check spelling and make sure your guess is a real molecule</p>
  </body>
</html>

